{"ast":null,"code":"/** @license MIT License (c) copyright 2010-2014 original author or authors */\n\n/** @author Brian Cavalier */\n\n/** @author John Hann */\n(function (define) {\n  'use strict';\n\n  define(function (require) {\n    var defaultStackJumpSeparator = 'from execution context:';\n    var defaultStackFilter = /[\\s\\(\\/\\\\](node|module|timers)\\.js:|when([\\/\\\\]{1,2}(lib|monitor|es6-shim)[\\/\\\\]{1,2}|\\.js)|(new\\sPromise)\\b|(\\b(PromiseMonitor|ConsoleReporter|Scheduler|RunHandlerTask|ProgressTask|Promise|.*Handler)\\.[\\w_]\\w\\w+\\b)|\\b(tryCatch\\w+|getHandler\\w*)\\b/i;\n\n    var setTimer = require('../lib/env').setTimer;\n\n    var error = require('./error');\n\n    var executionContext = [];\n\n    function PromiseMonitor(reporter) {\n      this.logDelay = 0;\n      this.stackFilter = defaultStackFilter;\n      this.stackJumpSeparator = defaultStackJumpSeparator;\n      this.filterDuplicateFrames = true;\n      this._reporter = reporter;\n\n      if (typeof reporter.configurePromiseMonitor === 'function') {\n        reporter.configurePromiseMonitor(this);\n      }\n\n      this._traces = [];\n      this._traceTask = 0;\n      var self = this;\n\n      this._doLogTraces = function () {\n        self._logTraces();\n      };\n    }\n\n    PromiseMonitor.prototype.monitor = function (Promise) {\n      var self = this;\n\n      Promise.createContext = function (p, context) {\n        p.context = self.createContext(p, context);\n      };\n\n      Promise.enterContext = function (p) {\n        executionContext.push(p.context);\n      };\n\n      Promise.exitContext = function () {\n        executionContext.pop();\n      };\n\n      Promise.onPotentiallyUnhandledRejection = function (rejection, extraContext) {\n        return self.addTrace(rejection, extraContext);\n      };\n\n      Promise.onPotentiallyUnhandledRejectionHandled = function (rejection) {\n        return self.removeTrace(rejection);\n      };\n\n      Promise.onFatalRejection = function (rejection, extraContext) {\n        return self.fatal(rejection, extraContext);\n      };\n\n      return this;\n    };\n\n    PromiseMonitor.prototype.createContext = function (at, parentContext) {\n      var context = {\n        parent: parentContext || executionContext[executionContext.length - 1],\n        stack: void 0\n      };\n      error.captureStack(context, at.constructor);\n      return context;\n    };\n\n    PromiseMonitor.prototype.addTrace = function (handler, extraContext) {\n      var t, i;\n\n      for (i = this._traces.length - 1; i >= 0; --i) {\n        t = this._traces[i];\n\n        if (t.handler === handler) {\n          break;\n        }\n      }\n\n      if (i >= 0) {\n        t.extraContext = extraContext;\n      } else {\n        this._traces.push({\n          handler: handler,\n          extraContext: extraContext\n        });\n      }\n\n      this.logTraces();\n    };\n\n    PromiseMonitor.prototype.removeTrace = function ()\n    /*handler*/\n    {\n      this.logTraces();\n    };\n\n    PromiseMonitor.prototype.fatal = function (handler, extraContext) {\n      var err = new Error();\n      err.stack = this._createLongTrace(handler.value, handler.context, extraContext).join('\\n');\n      setTimer(function () {\n        throw err;\n      }, 0);\n    };\n\n    PromiseMonitor.prototype.logTraces = function () {\n      if (!this._traceTask) {\n        this._traceTask = setTimer(this._doLogTraces, this.logDelay);\n      }\n    };\n\n    PromiseMonitor.prototype._logTraces = function () {\n      this._traceTask = void 0;\n      this._traces = this._traces.filter(filterHandled);\n\n      this._reporter.log(this.formatTraces(this._traces));\n    };\n\n    PromiseMonitor.prototype.formatTraces = function (traces) {\n      return traces.map(function (t) {\n        return this._createLongTrace(t.handler.value, t.handler.context, t.extraContext);\n      }, this);\n    };\n\n    PromiseMonitor.prototype._createLongTrace = function (e, context, extraContext) {\n      var trace = error.parse(e) || [String(e) + ' (WARNING: non-Error used)'];\n      trace = filterFrames(this.stackFilter, trace, 0);\n\n      this._appendContext(trace, context);\n\n      this._appendContext(trace, extraContext);\n\n      return this.filterDuplicateFrames ? this._removeDuplicates(trace) : trace;\n    };\n\n    PromiseMonitor.prototype._removeDuplicates = function (trace) {\n      var seen = {};\n      var sep = this.stackJumpSeparator;\n      var count = 0;\n      return trace.reduceRight(function (deduped, line, i) {\n        if (i === 0) {\n          deduped.unshift(line);\n        } else if (line === sep) {\n          if (count > 0) {\n            deduped.unshift(line);\n            count = 0;\n          }\n        } else if (!seen[line]) {\n          seen[line] = true;\n          deduped.unshift(line);\n          ++count;\n        }\n\n        return deduped;\n      }, []);\n    };\n\n    PromiseMonitor.prototype._appendContext = function (trace, context) {\n      trace.push.apply(trace, this._createTrace(context));\n    };\n\n    PromiseMonitor.prototype._createTrace = function (traceChain) {\n      var trace = [];\n      var stack;\n\n      while (traceChain) {\n        stack = error.parse(traceChain);\n\n        if (stack) {\n          stack = filterFrames(this.stackFilter, stack);\n          appendStack(trace, stack, this.stackJumpSeparator);\n        }\n\n        traceChain = traceChain.parent;\n      }\n\n      return trace;\n    };\n\n    function appendStack(trace, stack, separator) {\n      if (stack.length > 1) {\n        stack[0] = separator;\n        trace.push.apply(trace, stack);\n      }\n    }\n\n    function filterFrames(stackFilter, stack) {\n      return stack.filter(function (frame) {\n        return !stackFilter.test(frame);\n      });\n    }\n\n    function filterHandled(t) {\n      return !t.handler.handled;\n    }\n\n    return PromiseMonitor;\n  });\n})(typeof define === 'function' && define.amd ? define : function (factory) {\n  module.exports = factory(require);\n});","map":{"version":3,"sources":["/home/vladic4t/Desktop/mydev/ChipChapProject/chipchap/node_modules/when/monitor/PromiseMonitor.js"],"names":["define","require","defaultStackJumpSeparator","defaultStackFilter","setTimer","error","executionContext","PromiseMonitor","reporter","logDelay","stackFilter","stackJumpSeparator","filterDuplicateFrames","_reporter","configurePromiseMonitor","_traces","_traceTask","self","_doLogTraces","_logTraces","prototype","monitor","Promise","createContext","p","context","enterContext","push","exitContext","pop","onPotentiallyUnhandledRejection","rejection","extraContext","addTrace","onPotentiallyUnhandledRejectionHandled","removeTrace","onFatalRejection","fatal","at","parentContext","parent","length","stack","captureStack","constructor","handler","t","i","logTraces","err","Error","_createLongTrace","value","join","filter","filterHandled","log","formatTraces","traces","map","e","trace","parse","String","filterFrames","_appendContext","_removeDuplicates","seen","sep","count","reduceRight","deduped","line","unshift","apply","_createTrace","traceChain","appendStack","separator","frame","test","handled","amd","factory","module","exports"],"mappings":"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","sourcesContent":["/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\n(function(define) { 'use strict';\ndefine(function(require) {\n\n\tvar defaultStackJumpSeparator = 'from execution context:';\n\tvar defaultStackFilter = /[\\s\\(\\/\\\\](node|module|timers)\\.js:|when([\\/\\\\]{1,2}(lib|monitor|es6-shim)[\\/\\\\]{1,2}|\\.js)|(new\\sPromise)\\b|(\\b(PromiseMonitor|ConsoleReporter|Scheduler|RunHandlerTask|ProgressTask|Promise|.*Handler)\\.[\\w_]\\w\\w+\\b)|\\b(tryCatch\\w+|getHandler\\w*)\\b/i;\n\n\tvar setTimer = require('../lib/env').setTimer;\n\tvar error = require('./error');\n\n\tvar executionContext = [];\n\n\tfunction PromiseMonitor(reporter) {\n\t\tthis.logDelay = 0;\n\t\tthis.stackFilter = defaultStackFilter;\n\t\tthis.stackJumpSeparator = defaultStackJumpSeparator;\n\t\tthis.filterDuplicateFrames = true;\n\n\t\tthis._reporter = reporter;\n\t\tif(typeof reporter.configurePromiseMonitor === 'function') {\n\t\t\treporter.configurePromiseMonitor(this);\n\t\t}\n\n\t\tthis._traces = [];\n\t\tthis._traceTask = 0;\n\n\t\tvar self = this;\n\t\tthis._doLogTraces = function() {\n\t\t\tself._logTraces();\n\t\t};\n\t}\n\n\tPromiseMonitor.prototype.monitor = function(Promise) {\n\t\tvar self = this;\n\t\tPromise.createContext = function(p, context) {\n\t\t\tp.context = self.createContext(p, context);\n\t\t};\n\n\t\tPromise.enterContext = function(p) {\n\t\t\texecutionContext.push(p.context);\n\t\t};\n\n\t\tPromise.exitContext = function() {\n\t\t\texecutionContext.pop();\n\t\t};\n\n\t\tPromise.onPotentiallyUnhandledRejection = function(rejection, extraContext) {\n\t\t\treturn self.addTrace(rejection, extraContext);\n\t\t};\n\n\t\tPromise.onPotentiallyUnhandledRejectionHandled = function(rejection) {\n\t\t\treturn self.removeTrace(rejection);\n\t\t};\n\n\t\tPromise.onFatalRejection = function(rejection, extraContext) {\n\t\t\treturn self.fatal(rejection, extraContext);\n\t\t};\n\n\t\treturn this;\n\t};\n\n\tPromiseMonitor.prototype.createContext = function(at, parentContext) {\n\t\tvar context = {\n\t\t\tparent: parentContext || executionContext[executionContext.length - 1],\n\t\t\tstack: void 0\n\t\t};\n\t\terror.captureStack(context, at.constructor);\n\t\treturn context;\n\t};\n\n\tPromiseMonitor.prototype.addTrace = function(handler, extraContext) {\n\t\tvar t, i;\n\n\t\tfor(i = this._traces.length-1; i >= 0; --i) {\n\t\t\tt = this._traces[i];\n\t\t\tif(t.handler === handler) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif(i >= 0) {\n\t\t\tt.extraContext = extraContext;\n\t\t} else {\n\t\t\tthis._traces.push({\n\t\t\t\thandler: handler,\n\t\t\t\textraContext: extraContext\n\t\t\t});\n\t\t}\n\n\t\tthis.logTraces();\n\t};\n\n\tPromiseMonitor.prototype.removeTrace = function(/*handler*/) {\n\t\tthis.logTraces();\n\t};\n\n\tPromiseMonitor.prototype.fatal = function(handler, extraContext) {\n\t\tvar err = new Error();\n\t\terr.stack = this._createLongTrace(handler.value, handler.context, extraContext).join('\\n');\n\t\tsetTimer(function() {\n\t\t\tthrow err;\n\t\t}, 0);\n\t};\n\n\tPromiseMonitor.prototype.logTraces = function() {\n\t\tif(!this._traceTask) {\n\t\t\tthis._traceTask = setTimer(this._doLogTraces, this.logDelay);\n\t\t}\n\t};\n\n\tPromiseMonitor.prototype._logTraces = function() {\n\t\tthis._traceTask = void 0;\n\t\tthis._traces = this._traces.filter(filterHandled);\n\t\tthis._reporter.log(this.formatTraces(this._traces));\n\t};\n\n\n\tPromiseMonitor.prototype.formatTraces = function(traces) {\n\t\treturn traces.map(function(t) {\n\t\t\treturn this._createLongTrace(t.handler.value, t.handler.context, t.extraContext);\n\t\t}, this);\n\t};\n\n\tPromiseMonitor.prototype._createLongTrace = function(e, context, extraContext) {\n\t\tvar trace = error.parse(e) || [String(e) + ' (WARNING: non-Error used)'];\n\t\ttrace = filterFrames(this.stackFilter, trace, 0);\n\t\tthis._appendContext(trace, context);\n\t\tthis._appendContext(trace, extraContext);\n\t\treturn this.filterDuplicateFrames ? this._removeDuplicates(trace) : trace;\n\t};\n\n\tPromiseMonitor.prototype._removeDuplicates = function(trace) {\n\t\tvar seen = {};\n\t\tvar sep = this.stackJumpSeparator;\n\t\tvar count = 0;\n\t\treturn trace.reduceRight(function(deduped, line, i) {\n\t\t\tif(i === 0) {\n\t\t\t\tdeduped.unshift(line);\n\t\t\t} else if(line === sep) {\n\t\t\t\tif(count > 0) {\n\t\t\t\t\tdeduped.unshift(line);\n\t\t\t\t\tcount = 0;\n\t\t\t\t}\n\t\t\t} else if(!seen[line]) {\n\t\t\t\tseen[line] = true;\n\t\t\t\tdeduped.unshift(line);\n\t\t\t\t++count;\n\t\t\t}\n\t\t\treturn deduped;\n\t\t}, []);\n\t};\n\n\tPromiseMonitor.prototype._appendContext = function(trace, context) {\n\t\ttrace.push.apply(trace, this._createTrace(context));\n\t};\n\n\tPromiseMonitor.prototype._createTrace = function(traceChain) {\n\t\tvar trace = [];\n\t\tvar stack;\n\n\t\twhile(traceChain) {\n\t\t\tstack = error.parse(traceChain);\n\n\t\t\tif (stack) {\n\t\t\t\tstack = filterFrames(this.stackFilter, stack);\n\t\t\t\tappendStack(trace, stack, this.stackJumpSeparator);\n\t\t\t}\n\n\t\t\ttraceChain = traceChain.parent;\n\t\t}\n\n\t\treturn trace;\n\t};\n\n\tfunction appendStack(trace, stack, separator) {\n\t\tif (stack.length > 1) {\n\t\t\tstack[0] = separator;\n\t\t\ttrace.push.apply(trace, stack);\n\t\t}\n\t}\n\n\tfunction filterFrames(stackFilter, stack) {\n\t\treturn stack.filter(function(frame) {\n\t\t\treturn !stackFilter.test(frame);\n\t\t});\n\t}\n\n\tfunction filterHandled(t) {\n\t\treturn !t.handler.handled;\n\t}\n\n\treturn PromiseMonitor;\n});\n}(typeof define === 'function' && define.amd ? define : function(factory) { module.exports = factory(require); }));\n"]},"metadata":{},"sourceType":"script"}