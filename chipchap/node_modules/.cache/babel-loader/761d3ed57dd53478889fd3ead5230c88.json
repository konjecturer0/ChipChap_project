{"ast":null,"code":"var _jsxFileName = \"/home/vladic4t/Desktop/mydev/ChiChapProject/chipchap/src/components/App.js\";\nimport React from 'react'; // MicroComponents\n\nimport NewChat from '../components/buttons/NewChat';\nimport ChatHead from '../components/ChatsHead'; // Components\n\nimport Contacts from '../components/Contacts';\nimport Chat from '../components/MainChat/Chat'; // Styles\n\nimport Container from '../styles/App/container.tw'; // Autobahn\n\nimport autobahn from 'autobahn';\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      userid: null,\n      userSelect: '',\n      users: [],\n      messageStore: [],\n      filterChat: '',\n      messagecount: []\n    };\n\n    this.toggleChat = user => {\n      console.log(`TOGGLER >>>>${user.id}`);\n      this.setState({\n        userSelect: user.id\n      });\n    };\n\n    this.onStoreClean = id => {\n      const removeUser = id => {\n        const messageStorage = this.state.messageStore;\n        console.log(\"BEFORE NEW MESSAGE STORE\");\n        console.log(messageStorage);\n        let newMessageStorage = [];\n\n        for (let i = 0; i < messageStorage.length; i++) {\n          if (!messageStorage[i][id]) {\n            newMessageStorage.push(messageStorage[i]);\n          }\n        }\n\n        console.log(\"NEW MESSAGE STORE\");\n        console.log(newMessageStorage);\n        console.log(\"END NEW MESSAGE STORE\");\n        return newMessageStorage;\n      };\n\n      const msgStorage = removeUser(id);\n      this.setState({\n        messageStore: msgStorage\n      }, () => console.log(this.state.messageStore));\n    };\n\n    this.trackMessageNotify = ([message, userid]) => {\n      console.log(\"*****USERID\");\n      console.log(`THIS>>>>${String(userid)}`);\n      console.log(this.state.userSelect);\n\n      if (this.state.userSelect !== userid) {\n        let userStore = []; // for (let i=0; i<this.state.messageStore.length;i++) {\n        //     if (Object.keys(this.state.messageStore[i])[0] === userid) {\n        //         userStore = [...this.state.messageStore[i][userid], message[0]];\n        //     } \n        // }\n\n        if (this.state.messageStore.length === 0) {\n          userStore = [...userStore, {\n            [userid]: [message[0]]\n          }];\n        } else {\n          for (let i = 0; i < this.state.messageStore.length; i++) {\n            if (Object.keys(this.state.messageStore[i])[0] !== userid) {\n              userStore = [...userStore, this.state.messageStore[i]];\n            } else if (Object.keys(this.state.messageStore[i])[0] === userid) {\n              userStore = [...userStore, {\n                [userid]: [...this.state.messageStore[i][userid], message[0]]\n              }];\n            } else {\n              userStore = [...userStore, {\n                [userid]: [message[0]]\n              }];\n            }\n          }\n        }\n\n        this.setState({\n          messageStore: userStore\n        });\n      }\n    };\n\n    this.selectUserChat = users => {\n      for (let i = 0; i < users.length; i++) {\n        if (users[i].id === this.state.userSelect) {\n          return users[i];\n        }\n      }\n    };\n\n    this.onSearch = e => {\n      let value = e.target.value;\n      this.setState({\n        filterChat: value\n      });\n    };\n\n    this.sess = null;\n  }\n\n  componentDidMount() {\n    let connection = new autobahn.Connection({\n      transports: [{\n        type: \"websocket\",\n        url: 'ws://192.168.2.115:8080'\n      }],\n      realm: 'chat'\n    });\n\n    connection.onopen = (session, details) => {\n      console.log(\"!! Got a connection\");\n      console.log(session);\n      console.log(details);\n      this.sess = session;\n      session.call('com.chipchap.session.user.actions:contacts').then(result => {\n        // console.log(result[0]);\n        this.setState({\n          users: [...this.state.users, ...result]\n        });\n      }, error => {\n        console.log(\"!!ERROR\");\n        console.log(error);\n      });\n      session.call('com.chipchap.session.user.actions:getmyID').then(result => {\n        this.setState({\n          userid: result\n        });\n        console.log(`GOT ID:${result}`);\n        session.subscribe(`com.chipchap.session.user.actions:listen:${result}`, this.trackMessageNotify).then(subscription => {\n          console.log(\"subscription to <<listen>> succeded\");\n        }, error => {\n          console.log(\"received error with subscription to <<listen>>\");\n          console.log(error);\n        });\n      }, error => {\n        console.log(\"GOT AN ERROR! WHILE CALLING: GETMYID\");\n        console.log(error);\n      });\n    };\n\n    connection.onclose = function (session, details) {\n      console.log(session, details);\n    };\n\n    connection.open();\n  }\n\n  selectMessageStore() {\n    const user = this.selectUserChat(this.state.users);\n    console.log(\"*.*.*.* INSIDE SELECT MESSAGE STORAGE\");\n    console.log(user);\n    const messageStorage = this.state.messageStore;\n\n    for (let i = 0; i < messageStorage.length; i++) {\n      console.log(messageStorage);\n\n      if (Object.keys(messageStorage[i])[0] === user.id) {\n        console.log(\"??? INSIDE IF STATEMENT\");\n        console.log(messageStorage[i]);\n        return messageStorage[i][user.id];\n      }\n    }\n\n    return [];\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(Container, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        borderColor: '#E6E5EA'\n      },\n      className: \"w-2/6 inline-flex flex-col align-top border-r h-screen\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"py-6 text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(NewChat, {\n      onClick: e => alert('For demonstration purposes, you can chat though'),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 25\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"py-2\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(ChatHead, {\n      onSearch: this.onSearch,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 25\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"py-2 overflow-y-scroll\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Contacts, {\n      filter: this.state.filterChat,\n      users: this.state.users,\n      onToggleChat: this.toggleChat,\n      user: this.state.userSelect,\n      trackNotify: this.state.messageStore,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 25\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"w-4/6 inline-flex flex-col\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 17\n      }\n    }, this.state.userSelect ? /*#__PURE__*/React.createElement(Chat, {\n      onMessageStoreClean: this.onStoreClean,\n      myid: this.state.userid,\n      user: this.selectUserChat(this.state.users),\n      session: this.sess,\n      messageNotify: this.selectMessageStore(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 29\n      }\n    }) : /*#__PURE__*/React.createElement(\"div\", {\n      className: \"w-full justify-center items-center flex py-64\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"h3\", {\n      style: {\n        color: '#BFBEC5'\n      },\n      className: \"cursor-default font-semibold text-4xl tracking-tight\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 33\n      }\n    }, \"Open a Chat\"), /*#__PURE__*/React.createElement(\"svg\", {\n      style: {\n        color: '#BFBEC5'\n      },\n      className: \"h-24 w-24 fill-current\",\n      version: \"1.1\",\n      viewBox: \"0 0 32 32\",\n      xmlns: \"http://www.w3.org/2000/svg\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 33\n      }\n    }, /*#__PURE__*/React.createElement(\"g\", {\n      id: \"Layer_1\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 171\n      }\n    }), /*#__PURE__*/React.createElement(\"g\", {\n      id: \"chat_x5F_alt_x5F_stroke\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 188\n      }\n    }, /*#__PURE__*/React.createElement(\"g\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 220\n      }\n    }, /*#__PURE__*/React.createElement(\"g\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 223\n      }\n    }, /*#__PURE__*/React.createElement(\"path\", {\n      d: \"M25.977,12.213c-0.027,1.387-0.336,2.695-0.883,3.889C27.977,16.582,28,18.93,28,20     c0,0.992,0,4-3.996,4H20c-2.605,0-4.938,1.258-6.398,3.203C12.633,26.469,12,25.305,12,24v-4c0-0.791,0.141-1.414,0.359-1.928     C12.242,18.051,12.125,18,12,18H8.203c-0.129,0.619-0.199,1.281-0.199,2v4c0,4.418,3.578,8,7.996,8c0-2.211,1.789-4,4-4h4.004     C28,28,32,25.75,32,20C32,15.107,29.219,12.84,25.977,12.213z\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 226\n      }\n    })), /*#__PURE__*/React.createElement(\"path\", {\n      d: \"M16,4c1.492,0,4,0.52,4,4v4c0,1.309-0.633,2.471-1.602,3.201C16.938,13.26,14.609,12,12,12H8.004    C4,12,4,8.99,4,8c0-1.195,0-4,4.004-4H16 M16,0H8.004C4,0,0,2.125,0,8c0,5.75,4,8,8.004,8H12c2.211,0,4,1.793,4,4    c4.418,0,8.004-3.582,8.004-8V8C24.004,2.479,20,0,16,0L16,0z\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 638\n      }\n    })))))));\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/home/vladic4t/Desktop/mydev/ChiChapProject/chipchap/src/components/App.js"],"names":["React","NewChat","ChatHead","Contacts","Chat","Container","autobahn","App","Component","constructor","props","state","userid","userSelect","users","messageStore","filterChat","messagecount","toggleChat","user","console","log","id","setState","onStoreClean","removeUser","messageStorage","newMessageStorage","i","length","push","msgStorage","trackMessageNotify","message","String","userStore","Object","keys","selectUserChat","onSearch","e","value","target","sess","componentDidMount","connection","Connection","transports","type","url","realm","onopen","session","details","call","then","result","error","subscribe","subscription","onclose","open","selectMessageStore","render","borderColor","alert","color"],"mappings":"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","sourcesContent":["import React from 'react';\n\n// MicroComponents\nimport NewChat from '../components/buttons/NewChat';\nimport ChatHead from '../components/ChatsHead';\n\n// Components\nimport Contacts from '../components/Contacts';\nimport Chat from '../components/MainChat/Chat';\n\n// Styles\nimport Container from '../styles/App/container.tw';\n\n// Autobahn\nimport autobahn from 'autobahn';\n\nclass App extends React.Component {\n    \n\n    constructor(props) {\n        super(props);\n        this.sess = null;\n    }\n\n    state = {\n        userid: null,\n        userSelect: '',\n        users: [],\n        messageStore: [],\n        filterChat: '',\n        messagecount: []\n    };\n\n    componentDidMount() {\n        let connection = new autobahn.Connection({transports:[{type:\"websocket\", url: 'ws://192.168.2.115:8080'}], realm: 'chat'});\n        connection.onopen = (session, details) => {\n            console.log(\"!! Got a connection\");\n            console.log(session);\n            console.log(details);\n            this.sess = session;\n            session.call('com.chipchap.session.user.actions:contacts').then(\n                (result) => {\n                    // console.log(result[0]);\n                    this.setState({users: [ ...this.state.users, ...result]});\n                },\n                (error) => {\n                    console.log(\"!!ERROR\");\n                    console.log(error);\n                }\n            );\n            session.call('com.chipchap.session.user.actions:getmyID').then(\n                (result) => {\n                    this.setState({userid: result});\n                    console.log(`GOT ID:${result}`);\n                    session.subscribe(`com.chipchap.session.user.actions:listen:${result}`, this.trackMessageNotify).then(\n                        (subscription) => {\n                            console.log(\"subscription to <<listen>> succeded\");\n                        },\n                        (error) => {\n                            console.log(\"received error with subscription to <<listen>>\")\n                            console.log(error);\n                        }\n                    );\n                },\n                (error) => {\n                    console.log(\"GOT AN ERROR! WHILE CALLING: GETMYID\");\n                    console.log(error);\n                }\n            );\n        }\n        connection.onclose = function(session, details) {\n            console.log(session, details);\n        }\n        connection.open();\n    }\n\n    toggleChat = (user) => {\n        console.log(`TOGGLER >>>>${user.id}`);\n        this.setState({userSelect: user.id});\n    }\n\n    onStoreClean = (id) => {\n        const removeUser = (id) => {\n            const messageStorage = this.state.messageStore;\n            console.log(\"BEFORE NEW MESSAGE STORE\");\n            console.log(messageStorage);\n            let newMessageStorage = [];\n            for (let i=0; i < messageStorage.length; i++) {\n                if (!messageStorage[i][id]) {\n                    newMessageStorage.push(messageStorage[i]);\n                }\n            }\n            console.log(\"NEW MESSAGE STORE\");\n            console.log(newMessageStorage);\n            console.log(\"END NEW MESSAGE STORE\");\n            return newMessageStorage;\n        }\n        const msgStorage = removeUser(id);\n        this.setState({messageStore: msgStorage}, ()=> console.log(this.state.messageStore));\n    }\n\n    trackMessageNotify = ([message, userid]) => {\n        console.log(\"*****USERID\");\n        console.log(`THIS>>>>${String(userid)}`);\n        console.log(this.state.userSelect);\n        if (this.state.userSelect !== userid) {\n            let userStore = [];\n            // for (let i=0; i<this.state.messageStore.length;i++) {\n            //     if (Object.keys(this.state.messageStore[i])[0] === userid) {\n            //         userStore = [...this.state.messageStore[i][userid], message[0]];\n            //     } \n            // }\n            if (this.state.messageStore.length === 0) {\n                userStore = [...userStore, {[userid]:[message[0]]}];\n            } else {\n                for (let i=0; i<this.state.messageStore.length;i++) {\n                    if (Object.keys(this.state.messageStore[i])[0] !== userid) {\n                        userStore = [...userStore, this.state.messageStore[i]];\n                    } else if (Object.keys(this.state.messageStore[i])[0] === userid) {\n                        userStore = [...userStore, {[userid]:[...this.state.messageStore[i][userid], message[0]]}]\n                    } else {\n                        userStore = [...userStore, {[userid]:[message[0]]}];\n                    }\n                }\n            }\n            this.setState({messageStore: userStore});\n        }\n    }\n\n    selectUserChat = (users) => {\n        for (let i=0; i < users.length; i++) {\n            if (users[i].id === this.state.userSelect) {\n                return users[i];\n            }\n        }\n    }\n\n    selectMessageStore() {\n        const user = this.selectUserChat(this.state.users);\n        console.log(\"*.*.*.* INSIDE SELECT MESSAGE STORAGE\");\n        console.log(user);\n        const messageStorage = this.state.messageStore;\n        for (let i=0; i < messageStorage.length; i++) {\n            console.log(messageStorage);\n            if (Object.keys(messageStorage[i])[0] === user.id) {\n                console.log(\"??? INSIDE IF STATEMENT\");\n                console.log(messageStorage[i]);\n                return messageStorage[i][user.id];\n            }\n        }\n        return [];\n    }\n\n    onSearch = (e) => {\n        let value = e.target.value;\n        this.setState({filterChat: value});\n    }\n\n    render() {\n        return (\n            <Container>\n                <div style={{borderColor: '#E6E5EA'}} className=\"w-2/6 inline-flex flex-col align-top border-r h-screen\">\n                    {/******** BUTTON NEW CONVERSATION *****/}\n                    <div className=\"py-6 text-center\">\n                        <NewChat onClick={(e) => alert('For demonstration purposes, you can chat though')} />\n                    </div>\n                    {/******** CHATS & SEARCH *****/}\n                    <div className=\"py-2\">\n                        <ChatHead onSearch={this.onSearch} />\n                    </div>\n                    {/******** CONTACTS SECTION *****/}\n                    <div className=\"py-2 overflow-y-scroll\">\n                        <Contacts filter={this.state.filterChat} users={this.state.users} onToggleChat={this.toggleChat} user={this.state.userSelect} trackNotify={this.state.messageStore} />\n                    </div>\n                </div>\n                <div className=\"w-4/6 inline-flex flex-col\">\n                    {/*****  CHAT  *****/}\n                    {\n                        this.state.userSelect ? (\n                            <Chat onMessageStoreClean={this.onStoreClean} myid={this.state.userid} user={this.selectUserChat(this.state.users)} session={this.sess} messageNotify={this.selectMessageStore()} />\n                        ) : (\n                            <div className=\"w-full justify-center items-center flex py-64\">\n                                <h3 style={{color: '#BFBEC5'}} className=\"cursor-default font-semibold text-4xl tracking-tight\">Open a Chat</h3>\n                                <svg style={{color: '#BFBEC5'}} className=\"h-24 w-24 fill-current\" version=\"1.1\" viewBox=\"0 0 32 32\"  xmlns=\"http://www.w3.org/2000/svg\" ><g id=\"Layer_1\"/><g id=\"chat_x5F_alt_x5F_stroke\"><g><g><path d=\"M25.977,12.213c-0.027,1.387-0.336,2.695-0.883,3.889C27.977,16.582,28,18.93,28,20     c0,0.992,0,4-3.996,4H20c-2.605,0-4.938,1.258-6.398,3.203C12.633,26.469,12,25.305,12,24v-4c0-0.791,0.141-1.414,0.359-1.928     C12.242,18.051,12.125,18,12,18H8.203c-0.129,0.619-0.199,1.281-0.199,2v4c0,4.418,3.578,8,7.996,8c0-2.211,1.789-4,4-4h4.004     C28,28,32,25.75,32,20C32,15.107,29.219,12.84,25.977,12.213z\"/></g><path d=\"M16,4c1.492,0,4,0.52,4,4v4c0,1.309-0.633,2.471-1.602,3.201C16.938,13.26,14.609,12,12,12H8.004    C4,12,4,8.99,4,8c0-1.195,0-4,4.004-4H16 M16,0H8.004C4,0,0,2.125,0,8c0,5.75,4,8,8.004,8H12c2.211,0,4,1.793,4,4    c4.418,0,8.004-3.582,8.004-8V8C24.004,2.479,20,0,16,0L16,0z\" /></g></g></svg>\n                            </div>\n                        )\n                    }\n                </div>\n            </Container>\n        );\n    }\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}